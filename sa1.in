#!/bin/sh
# @SA_LIB_DIR@/sa1
# (C) 1999-2007 Sebastien Godard (sysstat <at> wanadoo.fr)
#
# 2007-01-21: Sebastien Godard (sysstat <at> wanadoo.fr)
#	Modified to handle multiple months history.
#	Original idea from John Caruso <caruso@paradiso.umuc.edu>
# 2007/02/07: Ivana Varekova <varekova@redhat.com>
#	Autoconf support added.
#
HISTORY=0
[ -r /etc/sysconfig/sysstat ] && . /etc/sysconfig/sysstat
if [ ${HISTORY} -gt 28 ]
then
	CURRENTDIR=`date +%Y%m`
	CURRENTFILE=sa`date +%d`
	DDIR=@SA_DIR@
	cd ${DDIR} || exit 1
	[ -d ${CURRENTDIR} ] || mkdir -p ${CURRENTDIR}
	touch ${CURRENTDIR}/${CURRENTFILE}
	# Remove the "compatibility" link and recreate it to point to
	# the (new) current file
	rm -f ${CURRENTFILE}
	ln -s ${CURRENTDIR}/${CURRENTFILE} ${CURRENTFILE}
fi
umask 0022
ENDIR=@SA_LIB_DIR@
cd ${ENDIR}
if [ $# = 0 ]
then
# Note: Stats are written at the end of previous file *and* at the
# beginning of the new one (when there is a file rotation) only if
# outfile has been specified as '-' on the command line...
	exec ${ENDIR}/sadc -F -L 1 1 -
else
	exec ${ENDIR}/sadc -F -L $* -
fi

